#!/bin/sh

prefix=/usr/local
unix_style=1
universal=1

if test `uname -s` = Darwin
then
	unix_style=0
fi

display_help () {
	echo "Usage: $0 [OPTION]"
	echo "Options:"
	echo "  --prefix=PREFIX	Install Leges Motus program and data at PREFIX [default: $prefix]"
	echo "  --unix-style		(Mac OS X only) Build without frameworks or .app bundle"
	echo "  --disable-universal	(Mac OS X only) Do not build universal binary"
	echo "  --help		Display this help"
}

format_boolean () {
	if test $1 -ne 0
	then
		echo "Yes"
	else
		echo "No"
	fi
}

for arg
do
	if test "$arg" = "--help"
	then
		display_help
		exit 0
	elif test "`echo $arg | cut -f1 -d=`" = "--prefix"
	then
		prefix="`echo "$arg" | cut -f2 -d=`"
	elif test "$arg" = "--unix-style"
	then
		unix_style=1
	elif test "$arg" = "--disable-universal"
	then
		universal=0
	else
		echo "$arg: Unknown argument" >&2
		display_help
		exit 2
	fi
done

if test $unix_style -eq 1
then
	echo -n "Checking for SDL... "
	if sdl-config --version >/dev/null 2>/dev/null
	then
		echo "Found"
	else
		echo "Not found"
		echo
		echo "SDL is required to build and run Leges Motus."
		echo "You can obtain SDL from http://www.libsdl.org/"
		echo "or install the appropriate package for your distro."
		echo "If you install a distro package, please make sure you also install the -devel package."
		exit 1
	fi
	echo
	echo
	echo "Prefix:           $prefix"
fi

if test `uname -s` = Darwin
then
	echo "Unix-style build: `format_boolean $unix_style`"
	echo "Universal build:  `format_boolean $universal`"
fi

echo

if test $unix_style -eq 0
then
	echo "Type 'make' to build and then 'make install' to install the Applications directory."
else
	echo "Type 'make' to build and then 'make install' to install into $prefix."
fi

echo '#' > Makefile.opts
echo '# This file was generated by running configure' >> Makefile.opts
echo '#' >> Makefile.opts
echo >> Makefile.opts

if test $unix_style -ne 0
then
	echo "PREFIX = $prefix" >> Makefile.opts
	echo 'BINDIR = $(PREFIX)/bin' >> Makefile.opts
	echo 'DATADIR = $(PREFIX)/share/games/legesmotus' >> Makefile.opts
	echo "UNIXSTYLE = 1" >> Makefile.opts
fi
if test $universal -ne 0
then
	echo "UNIVERSAL = 1" >> Makefile.opts
else
	echo "UNIVERSAL =" >> Makefile.opts
fi
